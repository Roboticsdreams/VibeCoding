<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WindsurfInterviewer - Technical Interview Simulator</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .chat-container {
            height: 65vh;
            overflow-y: auto;
            scroll-behavior: smooth;
        }
        .typing-indicator span {
            animation: blink 1.5s infinite;
            opacity: 0;
        }
        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }
        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }
        @keyframes blink {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }
        pre {
            white-space: pre-wrap;
            background-color: #f7f7f7;
            padding: 10px;
            border-radius: 4px;
        }
        code {
            font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8 max-w-5xl">
        <div class="bg-white rounded-lg shadow-lg p-6">
            <div class="flex items-center mb-6">
                <div class="h-14 w-14 rounded-full bg-blue-600 flex items-center justify-center text-white text-2xl font-bold">
                    WI
                </div>
                <div class="ml-4">
                    <h1 class="text-2xl font-bold text-gray-800">WindsurfInterviewer</h1>
                    <p class="text-gray-600">Java, Spring Boot & Microservices Technical Interview</p>
                </div>
                <div class="ml-auto">
                    <div class="bg-gray-200 rounded-lg px-4 py-2">
                        <span id="timer" class="font-mono text-xl">30:00</span>
                    </div>
                </div>
            </div>

            <div class="mb-4 bg-gray-50 rounded-lg p-4 chat-container" id="chat-container">
                <!-- Messages will be added here -->
            </div>

            <div class="flex gap-2">
                <textarea id="user-input" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Type your answer here..." rows="3"></textarea>
                <button id="send-button" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition">Send</button>
            </div>

            <div class="mt-4 flex justify-between">
                <button id="start-interview" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition">Start Interview</button>
                <button id="end-interview" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700 transition hidden">End Interview</button>
            </div>
        </div>
    </div>

    <script>
        // Interview questions
        const questions = [
            {
                category: "Introduction",
                question: "Hello! I'm WindsurfInterviewer, and I'll be conducting your technical interview today. We'll cover Java fundamentals, Spring Boot, SQL, and microservices architecture over the next 30 minutes. I'll ask one question at a time and provide feedback after each answer. Are you ready to begin?"
            },
            {
                category: "Java Core",
                question: "Let's start with Java fundamentals. Can you explain the difference between an interface and an abstract class in Java, and provide a scenario where you would prefer using one over the other?"
            },
            {
                category: "Java Core",
                question: "In Java, what are the key differences between ArrayList and LinkedList? When would you choose one over the other in terms of performance considerations?"
            },
            {
                category: "Java Core",
                question: "Could you explain Java's memory management and garbage collection process? How does the JVM determine which objects are eligible for garbage collection?"
            },
            {
                category: "Spring Boot",
                question: "Moving to Spring Boot now. What are the key advantages of using Spring Boot over traditional Spring Framework? Please explain how Spring Boot's auto-configuration works."
            },
            {
                category: "Spring Boot",
                question: "Can you explain the concept of dependency injection in Spring? What are the different types of dependency injection supported by Spring, and can you provide examples of when you would use each?"
            },
            {
                category: "Spring Boot",
                question: "How would you implement transaction management in a Spring Boot application? Please explain the propagation behaviors and isolation levels you might configure."
            },
            {
                category: "SQL",
                question: "Let's shift to SQL. Given two tables - Orders(order_id, customer_id, order_date, total_amount) and Customers(customer_id, name, email) - write a SQL query to find the top 3 customers who have spent the most in the past month."
            },
            {
                category: "Microservices",
                question: "Now for microservices architecture. What are the main challenges in implementing microservices and how would you address them? Please discuss issues like data consistency and service discovery."
            },
            {
                category: "Microservices",
                question: "Can you explain the Circuit Breaker pattern in the context of microservices? How would you implement it using a library like Hystrix or Resilience4j?"
            },
            {
                category: "Microservices",
                question: "How would you handle distributed transactions across multiple microservices? Please explain the Saga pattern and compare it with two-phase commit."
            },
            {
                category: "Final Question",
                question: "For our final question: Imagine you're designing a high-traffic e-commerce platform using microservices architecture. How would you ensure the system remains performant, scalable, and fault-tolerant? Please outline your architectural decisions and the technologies you would choose."
            }
        ];

        // Feedback templates
        const feedbackTemplates = {
            excellent: [
                "Excellent answer! Your explanation was comprehensive and technically accurate.",
                "Very well articulated! You demonstrated deep understanding of the concept.",
                "Outstanding response. You covered all key points with great clarity."
            ],
            good: [
                "Good answer. You covered the main points, though some additional details would strengthen it.",
                "Solid response. You have a good grasp of the concept.",
                "That's a good explanation. You touched on most of the important aspects."
            ],
            average: [
                "Acceptable answer, though there are some key points missing.",
                "Your understanding is basic but correct. Consider expanding your knowledge in this area.",
                "You've touched on some important aspects, but the explanation could be more complete."
            ],
            below_average: [
                "Your answer contains some misconceptions. Let me clarify before we move on.",
                "That's partially correct, but there are important concepts you've missed.",
                "Your response indicates some gaps in understanding this topic."
            ],
            poor: [
                "There are significant inaccuracies in your answer. Let's discuss the correct approach.",
                "This response suggests you might need to revisit the fundamentals of this topic.",
                "I appreciate your attempt, but this answer misses the mark on several key points."
            ]
        };

        // Final evaluation templates
        const finalEvaluationTemplates = {
            hire_strong: "Based on your performance in this interview, I would strongly recommend hiring you. You demonstrated exceptional technical knowledge across Java, Spring Boot, and microservices architecture. Your answers were clear, comprehensive, and showed both theoretical understanding and practical experience. You handled complex scenarios with confidence and displayed strong problem-solving skills.",
            
            hire: "Based on your performance in this interview, I would recommend hiring you. You demonstrated solid technical knowledge in most areas we covered. Your strengths were particularly evident in [AREAS]. While there's room for growth in [AREAS], you showed good problem-solving abilities and technical communication skills.",
            
            consider: "Based on your performance, I would consider you for the position with some reservations. You demonstrated good knowledge in [AREAS], but there were noticeable gaps in [AREAS]. With additional training and experience in these areas, you could become a strong contributor to the team.",
            
            no_hire: "Based on your performance in this interview, I would not recommend hiring you at this time. There were significant gaps in your knowledge of core concepts that would be essential for this role. I'd recommend focusing on strengthening your understanding of [AREAS] and gaining more practical experience before reapplying."
        };

        // State variables
        let currentQuestionIndex = 0;
        let interviewStarted = false;
        let interviewEnded = false;
        let timeRemaining = 30 * 60; // 30 minutes in seconds
        let timer;
        let candidateResponses = [];
        let evaluations = [];
        let typingIndicatorTimeout;
        let overallScore = 0;

        // DOM elements
        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const startButton = document.getElementById('start-interview');
        const endButton = document.getElementById('end-interview');
        const timerDisplay = document.getElementById('timer');

        // Initialize
        userInput.disabled = true;
        sendButton.disabled = true;

        // Event listeners
        startButton.addEventListener('click', startInterview);
        endButton.addEventListener('click', endInterview);
        sendButton.addEventListener('click', sendUserResponse);
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendUserResponse();
            }
        });

        function startInterview() {
            interviewStarted = true;
            startButton.classList.add('hidden');
            endButton.classList.remove('hidden');
            userInput.disabled = false;
            sendButton.disabled = false;
            
            // Start timer
            timer = setInterval(updateTimer, 1000);
            
            // Send first question
            setTimeout(() => {
                addInterviewerMessage(questions[0].question);
                currentQuestionIndex++;
            }, 500);
        }

        function endInterview() {
            if (!interviewEnded) {
                interviewEnded = true;
                clearInterval(timer);
                userInput.disabled = true;
                sendButton.disabled = true;
                endButton.disabled = true;
                
                // Provide final evaluation
                provideFinalEvaluation();
            }
        }

        function updateTimer() {
            timeRemaining--;
            
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            
            timerDisplay.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            
            if (timeRemaining <= 0) {
                clearInterval(timer);
                if (!interviewEnded) {
                    addInterviewerMessage("Our time is up! Let me provide you with a comprehensive evaluation of your performance.");
                    endInterview();
                }
            } else if (timeRemaining === 5 * 60) { // 5 minutes warning
                addInterviewerMessage("We have 5 minutes remaining in our interview. Let's continue with our remaining questions.");
            }
        }

        function sendUserResponse() {
            const response = userInput.value.trim();
            if (response && interviewStarted && !interviewEnded) {
                addUserMessage(response);
                userInput.value = '';
                candidateResponses.push(response);
                
                // Simulate interviewer typing
                showTypingIndicator();
                
                // Evaluate response and ask next question
                setTimeout(() => {
                    evaluateResponse(response);
                    if (currentQuestionIndex < questions.length && !interviewEnded) {
                        setTimeout(() => {
                            askNextQuestion();
                        }, 1500);
                    } else if (!interviewEnded) {
                        addInterviewerMessage("We've completed all the questions. Let me provide you with a comprehensive evaluation of your performance.");
                        endInterview();
                    }
                }, getRandomInt(2000, 4000)); // Random delay to simulate thinking
            }
        }

        function evaluateResponse(response) {
            hideTypingIndicator();
            
            // Randomly select feedback quality but weighted toward better feedback for demo purposes
            const rand = Math.random();
            let feedbackType;
            
            if (rand < 0.3) feedbackType = 'excellent';
            else if (rand < 0.6) feedbackType = 'good';
            else if (rand < 0.8) feedbackType = 'average';
            else if (rand < 0.95) feedbackType = 'below_average';
            else feedbackType = 'poor';
            
            // Map feedback type to score
            const scoreMap = {
                'excellent': 5,
                'good': 4,
                'average': 3,
                'below_average': 2,
                'poor': 1
            };
            
            overallScore += scoreMap[feedbackType];
            
            // Get random feedback from appropriate template
            const feedbacks = feedbackTemplates[feedbackType];
            const feedback = feedbacks[Math.floor(Math.random() * feedbacks.length)];
            
            evaluations.push({
                question: questions[currentQuestionIndex - 1].question,
                response: response,
                feedback: feedback,
                score: scoreMap[feedbackType]
            });
            
            addInterviewerMessage(feedback);
        }

        function askNextQuestion() {
            if (currentQuestionIndex < questions.length) {
                showTypingIndicator();
                
                setTimeout(() => {
                    hideTypingIndicator();
                    addInterviewerMessage(questions[currentQuestionIndex].question);
                    currentQuestionIndex++;
                }, getRandomInt(1000, 2000));
            }
        }

        function provideFinalEvaluation() {
            const totalPossibleScore = evaluations.length * 5;
            const percentageScore = (overallScore / totalPossibleScore) * 100;
            
            let finalEvaluation;
            let recommendation;
            
            if (percentageScore >= 85) {
                finalEvaluation = finalEvaluationTemplates.hire_strong;
                recommendation = "Strong Hire";
            } else if (percentageScore >= 70) {
                finalEvaluation = finalEvaluationTemplates.hire;
                recommendation = "Hire";
            } else if (percentageScore >= 55) {
                finalEvaluation = finalEvaluationTemplates.consider;
                recommendation = "Consider";
            } else {
                finalEvaluation = finalEvaluationTemplates.no_hire;
                recommendation = "No Hire";
            }
            
            // Customize evaluation based on performance
            let strengths = [];
            let weaknesses = [];
            
            evaluations.forEach(eval => {
                const category = questions.find(q => q.question === eval.question)?.category || "";
                if (eval.score >= 4) {
                    if (!strengths.includes(category)) strengths.push(category);
                } else if (eval.score <= 2) {
                    if (!weaknesses.includes(category)) weaknesses.push(category);
                }
            });
            
            // Replace placeholders
            finalEvaluation = finalEvaluation.replace('[AREAS]', strengths.join(', ') || 'most areas');
            finalEvaluation = finalEvaluation.replace('[AREAS]', weaknesses.join(', ') || 'some areas');
            
            // Create detailed feedback message
            let feedbackMessage = `<h3 class="text-xl font-bold mb-4">Interview Evaluation</h3>`;
            
            // Overall score
            feedbackMessage += `<p class="mb-4"><strong>Overall Score:</strong> ${Math.round(percentageScore)}% (${overallScore}/${totalPossibleScore} points)</p>`;
            feedbackMessage += `<p class="mb-4"><strong>Recommendation:</strong> <span class="font-bold ${recommendation === 'No Hire' ? 'text-red-600' : recommendation === 'Strong Hire' ? 'text-green-600' : 'text-blue-600'}">${recommendation}</span></p>`;
            
            // Strengths and weaknesses
            if (strengths.length > 0) {
                feedbackMessage += `<p class="mb-2"><strong>Strengths:</strong> ${strengths.join(', ')}</p>`;
            }
            if (weaknesses.length > 0) {
                feedbackMessage += `<p class="mb-4"><strong>Areas for Improvement:</strong> ${weaknesses.join(', ')}</p>`;
            }
            
            // Detailed question feedback
            feedbackMessage += `<h4 class="text-lg font-bold mt-4 mb-2">Question-by-Question Feedback:</h4>`;
            feedbackMessage += `<div class="space-y-4">`;
            
            evaluations.forEach((eval, index) => {
                const category = questions.find(q => q.question === eval.question)?.category || "";
                feedbackMessage += `
                    <div class="p-3 border rounded-lg ${eval.score >= 4 ? 'border-green-200 bg-green-50' : eval.score <= 2 ? 'border-red-200 bg-red-50' : 'border-yellow-200 bg-yellow-50'}">
                        <p><strong>Q${index + 1} (${category}):</strong> ${eval.question}</p>
                        <p class="mt-1"><strong>Score:</strong> ${eval.score}/5</p>
                        <p class="mt-1"><strong>Feedback:</strong> ${eval.feedback}</p>
                    </div>
                `;
            });
            
            feedbackMessage += `</div>`;
            
            // Final evaluation
            feedbackMessage += `<h4 class="text-lg font-bold mt-6 mb-2">Final Assessment:</h4>`;
            feedbackMessage += `<p>${finalEvaluation}</p>`;
            
            // Thank you message
            feedbackMessage += `<p class="mt-4">Thank you for participating in this interview simulation. I hope you found this experience valuable!</p>`;
            
            addInterviewerMessage(feedbackMessage, true);
        }

        function addInterviewerMessage(message, isHTML = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'flex mb-4';
            
            const avatarDiv = document.createElement('div');
            avatarDiv.className = 'h-10 w-10 rounded-full bg-blue-600 flex items-center justify-center text-white text-sm font-bold flex-shrink-0';
            avatarDiv.textContent = 'WI';
            
            const textDiv = document.createElement('div');
            textDiv.className = 'ml-3 bg-blue-100 py-2 px-4 rounded-lg max-w-3xl';
            
            if (isHTML) {
                textDiv.innerHTML = message;
            } else {
                // Convert markdown-like code blocks to HTML
                let formattedMessage = message.replace(/```([a-z]*)([\s\S]*?)```/g, '<pre><code class="language-$1">$2</code></pre>');
                
                // Simple formatting for bold and italics
                formattedMessage = formattedMessage.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                formattedMessage = formattedMessage.replace(/\*(.*?)\*/g, '<em>$1</em>');
                
                // Convert newlines to <br>
                formattedMessage = formattedMessage.replace(/\n/g, '<br>');
                
                textDiv.innerHTML = formattedMessage;
            }
            
            messageDiv.appendChild(avatarDiv);
            messageDiv.appendChild(textDiv);
            
            chatContainer.appendChild(messageDiv);
            scrollToBottom();
        }

        function addUserMessage(message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'flex mb-4 justify-end';
            
            const textDiv = document.createElement('div');
            textDiv.className = 'mr-3 bg-gray-300 py-2 px-4 rounded-lg max-w-3xl';
            
            // Convert newlines to <br>
            const formattedMessage = message.replace(/\n/g, '<br>');
            textDiv.innerHTML = formattedMessage;
            
            const avatarDiv = document.createElement('div');
            avatarDiv.className = 'h-10 w-10 rounded-full bg-gray-600 flex items-center justify-center text-white text-sm font-bold flex-shrink-0';
            avatarDiv.textContent = 'You';
            
            messageDiv.appendChild(textDiv);
            messageDiv.appendChild(avatarDiv);
            
            chatContainer.appendChild(messageDiv);
            scrollToBottom();
        }

        function showTypingIndicator() {
            clearTimeout(typingIndicatorTimeout);
            
            const indicatorDiv = document.createElement('div');
            indicatorDiv.className = 'flex mb-4 typing-indicator';
            indicatorDiv.id = 'typing-indicator';
            
            const avatarDiv = document.createElement('div');
            avatarDiv.className = 'h-10 w-10 rounded-full bg-blue-600 flex items-center justify-center text-white text-sm font-bold flex-shrink-0';
            avatarDiv.textContent = 'WI';
            
            const textDiv = document.createElement('div');
            textDiv.className = 'ml-3 bg-gray-200 py-2 px-4 rounded-lg';
            textDiv.innerHTML = '<span>.</span><span>.</span><span>.</span>';
            
            indicatorDiv.appendChild(avatarDiv);
            indicatorDiv.appendChild(textDiv);
            
            const existingIndicator = document.getElementById('typing-indicator');
            if (existingIndicator) {
                existingIndicator.remove();
            }
            
            chatContainer.appendChild(indicatorDiv);
            scrollToBottom();
        }

        function hideTypingIndicator() {
            const indicator = document.getElementById('typing-indicator');
            if (indicator) {
                indicator.remove();
            }
        }

        function scrollToBottom() {
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function getRandomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
    </script>
</body>
</html>
